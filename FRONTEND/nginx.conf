server {
    listen 80;
    listen [::]:80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html index.htm;

    # 1. การตั้งค่าสำหรับไฟล์ JS, CSS, และ Media (ให้แคชได้นาน)
    location ~* \.(js|css|json|png|jpg|jpeg|gif|ico)$ {
        # แคชไฟล์เหล่านี้ไว้ 1 ปี (ถ้าไฟล์เปลี่ยน ชื่อ Hash จะเปลี่ยน เบราว์เซอร์จะโหลดใหม่เอง)
        expires 365d; 
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # 2. การตั้งค่าสำหรับไฟล์ index.html (ห้ามแคชเด็ดขาด)
    location = /index.html {
        # สั่งให้เบราว์เซอร์ต้องตรวจสอบไฟล์นี้ใหม่กับ Server ทุกครั้ง
        add_header Cache-Control "no-cache, no-store, max-age=0, must-revalidate";
    }

    # 3. การตั้งค่าหลักสำหรับ Angular Routing
    location / {
        # คำสั่งสำหรับ Angular routing ที่เมื่อไม่พบไฟล์จะให้ส่ง index.html กลับไป
        try_files $uri $uri/ /index.html;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}